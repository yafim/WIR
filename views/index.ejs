<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<link rel="stylesheet" type="text/css" href="bootstrap/dist/css/bootstrap.css"  /> 

	<title>WhereIsRachel</title>
</head>

<body>

<div class="container">
	<h1><%= title %></h1>

	<ul>
		<% for (var i = 0; i < items.length; i++) { %>
		<li><%= "id:" +  items[i].id + " " + "Current Location:" +  items[i].currentLocation.lng + "," + items[i].currentLocation.lat  %> </li>
		<% } %>
	</ul>

	<form action="/add" method="post" name="myForm">
		<input type="hidden" name="newLocation">
		<input type="hidden" name="lat">
		<input type="hidden" name="lng">
		<input type="submit" onclick="addMarker()" >
	</form>

    <div id="map">
		<script async defer
	      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAs7C0NGcrkrDFvqrqH8_nzbwz1BrZIr4Y&callback=initMap">
	    </script>

	    <script>
	   		var coords;
	   		var map;
	   		var options;
	   		var marker;
	   		var items = <%- JSON.stringify(items) %>;

			function initMap(position) {
			  coords = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);
			  options = {
			    zoom: 9,
			    center: coords,
			    mapTypeControl: false,
			    navigationControlOptions: {
			    	style: google.maps.NavigationControlStyle.SMALL
			    },
			    mapTypeId: google.maps.MapTypeId.ROADMAP
			  };

			  map = new google.maps.Map(document.getElementById("map"), options);

			  

			  for (var key in items){
			  	var data = items[key];
			  	
			  	marker = new google.maps.Marker({
			  		position: new google.maps.LatLng(data.currentLocation.lat, data.currentLocation.lng),
			  		map: map
			  	});

}
			document.forms["myForm"].elements["lat"].value = position.coords.latitude;
			document.forms["myForm"].elements["lng"].value = position.coords.longitude;
			
			

			}

			// Adds a marker to the map.
			function addMarker() {
			  // Add the marker at the clicked location, and add the next-available label
			  // from the array of alphabetical characters.
			  marker = new google.maps.Marker({
			  	title: id,
			    position: coords,
			    map: map
			  });
			
			// Set the newLocation variable
			document.forms["myForm"].elements["newLocation"].value = coords;

			}

			if (navigator.geolocation) {
			  navigator.geolocation.getCurrentPosition(initMap);
			} else {
			  error('Geo Location is not supported');
			}


			google.maps.event.addDomListener(window, 'load', initMap);
			

	    </script>

	</div> 

</div>
		<script src="jquery/dist/jquery.js"></script>
		<script src="bootstrap/dist/js/bootstrap.js"></script>
</body>
</html>